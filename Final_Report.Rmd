---
title: "Experimental_Methodology"
author: "Mark Paluta, Krysten Thompson, Chris Ventura"
date: "March 10, 2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, message=FALSE, warning=FALSE}
library(data.table)
```

## Introduction / Background / Motivation

**Statement of the research question; why this is interesting to someone who is predisposed to be interested; what other people know about this; what (if any) obsrevational work has to say about this question**


< Background info on difficulties for older people finding housing >
- Fair housing act does not explicitly ban age discrimination in housing (https://www.justice.gov/crt/fair-housing-act-1)
- NYT article on rise of roommates for adults over 30 (https://www.nytimes.com/2016/05/06/fashion/mens-style/adult-men-roommates-new-york.html)
- Atlantic article on rise of roomates (https://www.theatlantic.com/family/archive/2018/08/the-strange-unique-intimacy-of-the-roommate-relationship/567296/)
- Zillow research article on doubling up (https://www.zillow.com/research/rising-rents-more-roommates-17618/)

In a recent study, Zillow found that the share of adults living with a non-spouse, non-partnered roomate increased from 21% in 2005 to 30% at the end of 2017.  Whether it is due to changing attitudes about living with roommates, a neccesity due to increased rents in major cities, or some other factor, the trend is clear: more Americans are cohabitating with someone other than a spouse or partner.  While college and post-college aged urbanites often expect to have roommates, the trend is increasing for those older than 30, as a recent New York Times profile depicts.  As employment opportunities continue to cluster in dense metropolitan areas such as New York and San Francisco, an older cohort may be forced to cohabitate in order to pursue economic opportunity.

In spite of this demographic trend, little research has been done into the availability and accessibility of roommates for different age groups.  As the New York Times profile describes, until recently the idea of having a roommate was mostly relegated to young professionals in their 20s.  Through this study, we set out to determine if older professionals face a penalty when seeking a roommate compared to someone in their 20's.

< Through our research, we find x >

< This is important because XYZ >

We would like to investigate whether age affects replies when responding to a roommate posting on Craigslist. Specifically, we want to determine whether age has a statistically significant effect on:

1) the odds of receiving a reply,
2) the odds of receiving a favorable reply, and
3) the response time of a reply

Thus, we will be developing at least one model specification for each question.

Response Definitions:
    Reply - any response from the person who posted the listing; could indicate vacancy filled, request more information, etc.
    Favorable Reply - response from listing poster suggesting time to show residence and received within 72 hours of inquiry email


## The Ideal Experiment

Our initial experiment sought to test gender and age discrimination. We initially set-up two email accounts for a female and two email accounts for a male. One email account for each would signify the 27-yr old, the other email account would be for the 43-yr old. We chose these ages to avoid round numbers, have the 20-something presumed to be slightly more established in a job/career than someone who is 22 or 23 (too young of an age may have caused bias), and have the older person at least over 40 but not yet 45 which may have caused bias as well. 

We also considered running this experiment in several different cities in the U.S. to see if regional differences exist in terms of gender and age.

A pilot was conducted in early March to determine if our initial approach would work and identify potential obstacles. We discovered issues with Craigslist and Gmail fraud mechanisms that led us to modify our approach. See Pilot Study below for further details. 

## Methodology

In order to be able to draw conclusions that could be somewhat generalized to the US population, Indianapolis was selected as the target market. 

 **Clear statement of the experiment**

    Research Design (using ROXO grammar)
    Randomization engineering
    Experimental materials (e.g. treatment materials)
    Measurement of variables
    Modeling choices
**end**

We went on Craigslist for data collection activities approximately once per day for ___ days/weeks. We were not too concerned with the exact times or days we collected data since we were collecting a number of time-based covariates in order to not confound our results with any temporal effects. We did make a conscious effort to cover a broad range of variation in our temporal covariates by collecting at least once on every day of the week and a mix of morning, afternoon, and evening collections.

Each time we began a collection activity, we would adhere to the following procedure:

1) Open all postings since the last data collection (or fewer if subject to time constraints, prioritizing recent postings)
2) Go through each post and throw out any that meet our exclusion criteria
3) Obtain a count of the number of included (remaining) posts
4) Randomize an array assigning these posts to our 27-year-old or 43-year-old persona.
5) Beginning with the first persona in the array, log into their respective email account and begin emailing posters in order from most recent to least, recording covariates as we go

Sufficiently later (make this clearer), we logged into the email accounts and recorded information about replies to our emails.

### Pilot Study

We conducted a pilot study for three days to identify any problems that may surface during the full study. The major things we learned from this pilot study were:

1) VPNs are not particularly compatible with Craigslist. < elaborate >

2) As a correlary to #2, maintaining too many personas would be very difficult due to concerns about tripping fraud algorithms and getting our real IP addresses blacklisted. As a result, we decided to limit our full study to 2 personas. We decided to imitate females as we made a guess that females would have higher response rates due to anecdotally more postings seeming open to females and an anecdotal guess that males would be more willing to live with females than females would be willing to live with males.

3) Not all types of posts seemed appropriate for measuring effects on a typical applicant. Specifically, we recognized the following types of posts as atypical scenarios and decided to exclude them from the full study.

#### Exclusion Criteria:

  a) Posts with sexual implications including "friends with benefits", reduced rent in exchange for sex, 
  b) Posts soliciting other favors in exchange for reduced rent such as babysitting
  c) Posts for students only
  d) Posts without an email option or posts explicitly stating that email replies will not be answered.
  e) Posts explicitly stating males only


 ...
< Any further pilot study learnings >



For each posting, we will note several covariates and we will give up to 48 (?) hours for a response.
All postings will be considered valid except for:

 -	Posts specifically seeking a certain age or sex (?)
 -	Duplicate postings as recognized via images, post title, or body text

## Data Collection


```{r include=FALSE}
df = read.csv("Data_Collection_Sheet.csv", fileEncoding="UTF-8-BOM")
```

We will collect a few types of information:

1) Title and body content of the post to assist in identifying duplicates and to archive this data in case the post is taken down.
```{r}
colnames(df)[4:5]
```

2) Post metadata
```{r}
colnames(df)[c(3,6)]
```

3) Covariates that may themselves predict high or low response rate
```{r}
colnames(df)[7:10]
```

4) Which treatment was applied
```{r}
colnames(df)[11]
```

5) Timestamp information for our response
```{r}
colnames(df)[1:2]
```

6) Reply (outcome) information
```{r}
colnames(df)[12:13]
```

### Generate fake data to build analysis tools

Building in a fake treatment effect where katie_27 gets more replies.

```{r}
set.seed(468)

date_gen = function(N, st="2019/03/15", et="2019/03/30") {
   st = as.POSIXct(as.Date(st))
   et = as.POSIXct(as.Date(et))
   dt = as.numeric(difftime(et,st,unit="sec"))
   ev = sort(runif(N, 0, dt))
   rt = st + ev
   return(rt)
}

fake_df = data.frame(
  "Posting.title" = rep(NA, 100),
  "Posting.body.text" = rep(NA, 100),
  "Posting.url" = rep(NA, 100),
  "Post.timestamp" = date_gen(100),
  "Listing.price" = runif(100, 300, 1000),
  "Listing.type" = sample(c("house","apartment","condo",NA), 100, replace = TRUE),
  "Poster.gender" = sample(c("male","female",NA), 100, replace = TRUE),
  "Poster.age" = sample(c(25:35,NA), 100, replace = TRUE),
  "Treatment" = sample(c("katie_27","katie_43"), 100, replace = TRUE)
)

# Pretend email was sent at random time up to one day after post
fake_df$Email.sent.datetime = fake_df$Post.timestamp + runif(100, 0, 3600*24)

fake_df = as.data.table(fake_df)

# Build fake logistic regression model to populate reply
beta0 = -.3
beta1 = .3
log.odds = beta0 + beta1 * as.integer(fake_df$Treatment=="katie_27")
prob = exp(log.odds) / (1 + exp(log.odds))
fake_df$Reply = as.integer(prob > runif(100,0,1))

# Pretend response was received at random time up to one day after our email
fake_df$Reply.timestamp = fake_df$Email.sent.datetime + runif(100, 0, 3600*24)
```


## Conclusions
**Clear statement of results**

    In text description of your results
    Figures and tables that support your in text description
    Clean, clear, well articulated relationships between your theory, your hypotheses, the numbers that your models produce, and the figures you present.
**end**
